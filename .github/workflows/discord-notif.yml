name: "Discord & Email Push Notification"

on:
  push:
    branches:
      - "**"
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“© Send Notification to Discord
        run: |
          AUTHOR=$(jq -r '.head_commit.author.name' "$GITHUB_EVENT_PATH")
          COMMITS=$(jq '.commits | length' "$GITHUB_EVENT_PATH")

          MESSAGE=$(echo -e "ğŸš€ New Push Detected!\nğŸ‘¤ Author: $AUTHOR\nğŸ“‚ Repo: ${GITHUB_REPOSITORY}\nğŸ”€ Branch: ${GITHUB_REF_NAME}\nğŸ“Œ Commit Count: $COMMITS" | jq -Rs .)

          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"content\": $MESSAGE}" \
            "${{ secrets.DISCORD_WEBHOOK_URL }}"

      # =============================
      #       ğŸ“§ EMAIL NOTIFIER
      # =============================
      - name: ğŸ“§ Send Email Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.GMAIL_USER }}
          password: ${{ secrets.GMAIL_APP_PASSWORD }}
          subject: "ğŸš€ New Push to ${GITHUB_REPOSITORY}"
          to: "bagas.purwadhika@gmail.com"
          from: "GitHub Notification Bot <${{ secrets.GMAIL_USER }}>"
          body: |
            Hallo Bagas ğŸ‘‹

            Ada push terbaru pada repositorymu!

            ğŸ”¥ Repo     : ${GITHUB_REPOSITORY}
            ğŸ”¥ Branch   : ${GITHUB_REF_NAME}
            ğŸ‘¤ Author   : $AUTHOR
            ğŸ“ Commits  : $COMMITS

            -- End of Message --
